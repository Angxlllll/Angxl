const countryFlags = Object.freeze({
  '1': 'ğŸ‡ºğŸ‡¸','7': 'ğŸ‡·ğŸ‡º','20': 'ğŸ‡ªğŸ‡¬','27': 'ğŸ‡¿ğŸ‡¦','30': 'ğŸ‡¬ğŸ‡·',
  '31': 'ğŸ‡³ğŸ‡±','32': 'ğŸ‡§ğŸ‡ª','33': 'ğŸ‡«ğŸ‡·','34': 'ğŸ‡ªğŸ‡¸','36': 'ğŸ‡­ğŸ‡º',
  '39': 'ğŸ‡®ğŸ‡¹','40': 'ğŸ‡·ğŸ‡´','41': 'ğŸ‡¨ğŸ‡­','43': 'ğŸ‡¦ğŸ‡¹','44': 'ğŸ‡¬ğŸ‡§',
  '45': 'ğŸ‡©ğŸ‡°','46': 'ğŸ‡¸ğŸ‡ª','47': 'ğŸ‡³ğŸ‡´','48': 'ğŸ‡µğŸ‡±','49': 'ğŸ‡©ğŸ‡ª',
  '51': 'ğŸ‡µğŸ‡ª','52': 'ğŸ‡²ğŸ‡½','53': 'ğŸ‡¨ğŸ‡º','54': 'ğŸ‡¦ğŸ‡·','55': 'ğŸ‡§ğŸ‡·',
  '56': 'ğŸ‡¨ğŸ‡±','57': 'ğŸ‡¨ğŸ‡´','58': 'ğŸ‡»ğŸ‡ª','60': 'ğŸ‡²ğŸ‡¾','61': 'ğŸ‡¦ğŸ‡º',
  '62': 'ğŸ‡®ğŸ‡©','63': 'ğŸ‡µğŸ‡­','64': 'ğŸ‡³ğŸ‡¿','65': 'ğŸ‡¸ğŸ‡¬','66': 'ğŸ‡¹ğŸ‡­',
  '81': 'ğŸ‡¯ğŸ‡µ','82': 'ğŸ‡°ğŸ‡·','84': 'ğŸ‡»ğŸ‡³','86': 'ğŸ‡¨ğŸ‡³',
  '90': 'ğŸ‡¹ğŸ‡·','91': 'ğŸ‡®ğŸ‡³','92': 'ğŸ‡µğŸ‡°','93': 'ğŸ‡¦ğŸ‡«',
  '94': 'ğŸ‡±ğŸ‡°','95': 'ğŸ‡²ğŸ‡²','98': 'ğŸ‡®ğŸ‡·',
  '211': 'ğŸ‡¸ğŸ‡¸','212': 'ğŸ‡²ğŸ‡¦','213': 'ğŸ‡©ğŸ‡¿','216': 'ğŸ‡¹ğŸ‡³','218': 'ğŸ‡±ğŸ‡¾',
  '220': 'ğŸ‡¬ğŸ‡²','221': 'ğŸ‡¸ğŸ‡³','222': 'ğŸ‡²ğŸ‡·','223': 'ğŸ‡²ğŸ‡±',
  '224': 'ğŸ‡¬ğŸ‡³','225': 'ğŸ‡¨ğŸ‡®','226': 'ğŸ‡§ğŸ‡«','227': 'ğŸ‡³ğŸ‡ª',
  '228': 'ğŸ‡¹ğŸ‡¬','229': 'ğŸ‡§ğŸ‡¯','230': 'ğŸ‡²ğŸ‡º','231': 'ğŸ‡±ğŸ‡·',
  '232': 'ğŸ‡¸ğŸ‡±','233': 'ğŸ‡¬ğŸ‡­','234': 'ğŸ‡³ğŸ‡¬','235': 'ğŸ‡¹ğŸ‡©',
  '236': 'ğŸ‡¨ğŸ‡«','237': 'ğŸ‡¨ğŸ‡²','238': 'ğŸ‡¨ğŸ‡»','239': 'ğŸ‡¸ğŸ‡¹',
  '240': 'ğŸ‡¬ğŸ‡¶','241': 'ğŸ‡¬ğŸ‡¦','242': 'ğŸ‡¨ğŸ‡¬','243': 'ğŸ‡¨ğŸ‡©',
  '244': 'ğŸ‡¦ğŸ‡´','245': 'ğŸ‡¬ğŸ‡¼','248': 'ğŸ‡¸ğŸ‡¨','249': 'ğŸ‡¸ğŸ‡©',
  '250': 'ğŸ‡·ğŸ‡¼','251': 'ğŸ‡ªğŸ‡¹','252': 'ğŸ‡¸ğŸ‡´','253': 'ğŸ‡©ğŸ‡¯',
  '254': 'ğŸ‡°ğŸ‡ª','255': 'ğŸ‡¹ğŸ‡¿','256': 'ğŸ‡ºğŸ‡¬','257': 'ğŸ‡§ğŸ‡®',
  '258': 'ğŸ‡²ğŸ‡¿','260': 'ğŸ‡¿ğŸ‡²','261': 'ğŸ‡²ğŸ‡¬','263': 'ğŸ‡¿ğŸ‡¼',
  '264': 'ğŸ‡³ğŸ‡¦','265': 'ğŸ‡²ğŸ‡¼','266': 'ğŸ‡±ğŸ‡¸','267': 'ğŸ‡§ğŸ‡¼',
  '268': 'ğŸ‡¸ğŸ‡¿','269': 'ğŸ‡°ğŸ‡²','290': 'ğŸ‡¸ğŸ‡­','291': 'ğŸ‡ªğŸ‡·',
  '297': 'ğŸ‡¦ğŸ‡¼','298': 'ğŸ‡«ğŸ‡´','299': 'ğŸ‡¬ğŸ‡±',
  '350': 'ğŸ‡¬ğŸ‡®','351': 'ğŸ‡µğŸ‡¹','352': 'ğŸ‡±ğŸ‡º','353': 'ğŸ‡®ğŸ‡ª',
  '354': 'ğŸ‡®ğŸ‡¸','355': 'ğŸ‡¦ğŸ‡±','356': 'ğŸ‡²ğŸ‡¹','357': 'ğŸ‡¨ğŸ‡¾',
  '358': 'ğŸ‡«ğŸ‡®','359': 'ğŸ‡§ğŸ‡¬','370': 'ğŸ‡±ğŸ‡¹','371': 'ğŸ‡±ğŸ‡»',
  '372': 'ğŸ‡ªğŸ‡ª','373': 'ğŸ‡²ğŸ‡©','374': 'ğŸ‡¦ğŸ‡²','375': 'ğŸ‡§ğŸ‡¾',
  '376': 'ğŸ‡¦ğŸ‡©','377': 'ğŸ‡²ğŸ‡¨','378': 'ğŸ‡¸ğŸ‡²','380': 'ğŸ‡ºğŸ‡¦',
  '381': 'ğŸ‡·ğŸ‡¸','382': 'ğŸ‡²ğŸ‡ª','385': 'ğŸ‡­ğŸ‡·','386': 'ğŸ‡¸ğŸ‡®',
  '387': 'ğŸ‡§ğŸ‡¦','389': 'ğŸ‡²ğŸ‡°','420': 'ğŸ‡¨ğŸ‡¿','421': 'ğŸ‡¸ğŸ‡°',
  '423': 'ğŸ‡±ğŸ‡®','500': 'ğŸ‡«ğŸ‡°','501': 'ğŸ‡§ğŸ‡¿','502': 'ğŸ‡¬ğŸ‡¹',
  '503': 'ğŸ‡¸ğŸ‡»','504': 'ğŸ‡­ğŸ‡³','505': 'ğŸ‡³ğŸ‡®','506': 'ğŸ‡¨ğŸ‡·',
  '507': 'ğŸ‡µğŸ‡¦','509': 'ğŸ‡­ğŸ‡¹','591': 'ğŸ‡§ğŸ‡´','593': 'ğŸ‡ªğŸ‡¨',
  '595': 'ğŸ‡µğŸ‡¾','598': 'ğŸ‡ºğŸ‡¾','670': 'ğŸ‡¹ğŸ‡±','672': 'ğŸ‡³ğŸ‡«',
  '673': 'ğŸ‡§ğŸ‡³','675': 'ğŸ‡µğŸ‡¬','676': 'ğŸ‡¹ğŸ‡´','677': 'ğŸ‡¸ğŸ‡§',
  '678': 'ğŸ‡»ğŸ‡º','679': 'ğŸ‡«ğŸ‡¯','852': 'ğŸ‡­ğŸ‡°','853': 'ğŸ‡²ğŸ‡´',
  '880': 'ğŸ‡§ğŸ‡©','886': 'ğŸ‡¹ğŸ‡¼','960': 'ğŸ‡²ğŸ‡»','961': 'ğŸ‡±ğŸ‡§',
  '962': 'ğŸ‡¯ğŸ‡´','964': 'ğŸ‡®ğŸ‡¶','965': 'ğŸ‡°ğŸ‡¼','966': 'ğŸ‡¸ğŸ‡¦',
  '971': 'ğŸ‡¦ğŸ‡ª','972': 'ğŸ‡®ğŸ‡±','973': 'ğŸ‡§ğŸ‡­','974': 'ğŸ‡¶ğŸ‡¦',
  '976': 'ğŸ‡²ğŸ‡³','977': 'ğŸ‡³ğŸ‡µ'
})

const prefixes = Object.keys(countryFlags).sort((a, b) => b.length - a.length)
const flagCache = new Map()

const getFlag = num => {
  let v = flagCache.get(num)
  if (v) return v
  let f = 'ğŸ³ï¸'
  for (const p of prefixes) {
    if (num.startsWith(p)) {
      f = countryFlags[p]
      break
    }
  }
  flagCache.set(num, f)
  return f
}

const handler = async (m, { conn, participants }) => {
  if (!m.isGroup) return

  if (!participants || !participants.length) {
    const meta = await conn.groupMetadata(m.chat)
    participants = meta.participants
  }

  conn.sendMessage(m.chat, { react: { text: 'ğŸ—£ï¸', key: m.key } })

  const lines = []
  const mentions = []

  for (const p of participants) {
    const jid = p.id || p.jid
    if (!jid) continue
    const num = jid.split('@')[0]
    lines.push(`â”ŠÂ» ${getFlag(num)} @${num}`)
    mentions.push(jid)
  }

  const text =
`!  MENCION GENERAL  !
PARA ${mentions.length} MIEMBROS ğŸ—£ï¸

${lines.join('\n')}`

  await conn.sendMessage(
    m.chat,
    { text, mentions },
    { quoted: m }
  )
}

handler.help = ['todos']
handler.tags = ['grupos']
handler.command = ["todos"];
handler.group = true
handler.admin = true

export default handler